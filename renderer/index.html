<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Verifone POS Agent</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 24px; background:#f6f8fb; color:#333; }
    h1 { margin: 0 0 6px; }
    h2 { margin: 18px 0 8px; font-size: 18px; }
    .grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:10px; }
    .row { margin: 8px 0; display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    label { font-size:12px; color:#555; display:block; }
    input, textarea, select { padding: 6px 8px; border:1px solid #cbd5e0; border-radius:6px; width:100%; box-sizing:border-box; }
    textarea { min-height: 72px; font-family: ui-monospace, Menlo, Consolas, monospace; }
    button { padding: 8px 14px; border:0; background:#2b6cb0; color:#fff; border-radius:6px; cursor:pointer; }
    button:hover { background:#2c5282; }
    fieldset { border:1px solid #e2e8f0; border-radius:8px; padding:12px; background:#fff; }
    legend { padding:0 6px; font-weight:bold; color:#2d3748; }
    #logArea { margin-top:16px; background:#eef2f7; border:1px solid #cbd5e0; padding:14px; min-height:260px; white-space:pre-wrap; border-radius:6px; font-family: ui-monospace, Menlo, Consolas, monospace; }
    .two { display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    .actions { display:flex; gap:8px; flex-wrap:wrap; }
    .muted { color:#666; font-size:12px; }
  </style>
</head>
<body>
  <h1>Verifone POS Agent</h1>
  <div class="row grid">
    <div>
      <label>Terminal IP</label>
      <input id="ip" value="192.168.1.91" />
      <!-- <input id="ip" value="192.168.29.179" /> -->
    </div>
    <div>
      <label>Port</label>
      <input id="port" value="8081" />
    </div>
    <div>
      <label>ECR ID</label>
      <input id="ecr" value="13" />
    </div>
  </div>

  <div class="actions">
    <button id="btnAvail">Check Availability</button>
    <button id="btnPing">Ping</button>
  </div>

  <fieldset>
    <legend>Sale</legend>
    <div class="grid">
      <div><label>Base Amount</label><input id="saleBase" value="4.00"></div>
      <div><label>Tip (optional)</label><input id="saleTip" placeholder="0.00"></div>
      <div><label>Tax (optional)</label><input id="saleTax" placeholder="0.00"></div>
      <div><label>Invoice # (optional)</label><input id="saleInvoice" placeholder="e.g. 12345"></div>
      <div>
        <label>Allow Partial Auth?</label>
        <select id="saleAllowPartial">
          <option value="">(default)</option>
          <option value="1">Yes (1)</option>
          <option value="0">No (0)</option>
        </select>
      </div>
    </div>
    <div class="actions"><button id="btnSale">Send Sale</button></div>
    <div class="muted">Tip/Tax optional per guide; baseAmount required. </div>
  </fieldset>

<fieldset>
  <legend>Manual Sale</legend>
  <div class="grid">
    <div><label>Base Amount</label><input id="msAmount" value="118.00"></div>
    <div><label>Card Number (PAN)</label><input id="msPan" value="5473530000000014"></div>
    <div><label>Expiry (MMYY)</label><input id="msExp" value="1225"></div>
    <div><label>CVV</label><input id="msCvv" value="321"></div>
    <div><label>AVS Address</label><input id="msAddr" value="76321"></div>
    <div><label>ZIP Code</label><input id="msZip" value="76321"></div>
  </div>
  <div class="actions"><button id="btnManualSale">Send Manual Sale</button></div>
  <div class="muted">Manual keyed entry (card not present) with AVS+CVV.</div>
</fieldset>

<!-- 
  <fieldset>
    <legend>PreAuth (with optional Lodging)</legend>
    <div class="grid">
      <div><label>Amount</label><input id="paAmount" value="10.00"></div>
      <div><label>Clerk ID (optional)</label><input id="paClerk" placeholder="1"></div>
    </div>
    <h2>Lodging (optional)</h2>
    <div class="grid">
      <div><label>Folio #</label><input id="lodFolio" placeholder="1"></div>
      <div><label>Stay Duration (1-99)</label><input id="lodStay" placeholder="3"></div>
      <div><label>Check-In (MMDDYYYY)</label><input id="lodIn" placeholder="01182022"></div>
      <div><label>Check-Out (MMDDYYYY)</label><input id="lodOut" placeholder="01202022"></div>
      <div><label>Daily Rate</label><input id="lodRate" placeholder="10.00"></div>
      <div><label>Preferred Customer (0/1)</label><input id="lodPref" placeholder="0"></div>
    </div>
    <div class="actions"><button id="btnPreAuth">Send PreAuth</button></div>
    <div class="muted">PreAuth uses <code>transaction.amount</code>. Lodging fields per guide; dates are MMDDYYYY.  </div>
  </fieldset> -->

  <fieldset>
    <legend>Void</legend>
    <div class="grid">
      <div><label>tranNo (or)</label><input id="voidTranNo" placeholder="0001"></div>
      <div><label>referenceNumber (or)</label><input id="voidRef" placeholder="1282447530"></div>
      <div><label>Invoice # (optional)</label><input id="voidInvoice" placeholder="1234"></div>
      <div><label>Clerk ID (optional)</label><input id="voidClerk" placeholder="1234"></div>
    </div>
    <div class="actions"><button id="btnVoid">Send Void</button></div>
    <div class="muted">Provide either <code>tranNo</code> or <code>referenceNumber</code> from prior sale. </div>
  </fieldset>
<!-- 
  <fieldset>
    <legend>Refund</legend>
    <div class="grid">
      <div><label>Total Amount</label><input id="rfTotal" value="5.00"></div>
      <div><label>referenceNumber (optional)</label><input id="rfRef" placeholder="1282446347"></div>
      <div><label>Invoice # (optional)</label><input id="rfInvoice" placeholder="12345"></div>
      <div><label>Clerk ID (optional)</label><input id="rfClerk" placeholder="1"></div>
    </div>
    <div class="actions"><button id="btnRefund">Send Refund</button></div>
    <div class="muted">Refund needs <code>transaction.totalAmount</code>; may reference prior txn. </div>
  </fieldset> -->
<!-- 
  <fieldset>
    <legend>Tip Adjust</legend>
    <div class="grid">
      <div><label>Tip Amount</label><input id="taTip" value="1.00"></div>
      <div><label>referenceNumber (preferred)</label><input id="taRef" placeholder="1864067304"></div>
      <div><label>tranNo (alt)</label><input id="taTranNo" placeholder="0003"></div>
      <div><label>Invoice # (alt)</label><input id="taInvoice" placeholder="1234"></div>
    </div>
    <div class="actions"><button id="btnTipAdjust">Send Tip Adjust</button></div>
    <div class="muted">Requires <code>tipAmount</code> plus a transaction identifier. </div>
  </fieldset> -->

  <fieldset>
    <legend>Batch Close / EOD</legend>
    <div class="actions"><button id="btnBatchClose">Send Batch Close (EOD)</button></div>
    <div class="muted">Closes the batch so approved transactions are settled (per guide). </div>
  </fieldset>

  <div id="logArea">Ready.</div>

  <script src="renderer.js"></script>
  <script>
    /* -------- Batch Close (EOD) -------- */

    
$('btnBatchClose').addEventListener('click', async () => {
  reset();
  const { ip, port, ecrId } = baseConn();
  console.log("hii this is VbtnBatchClose")
  const payload = { ip, port, ecrId, data: {} };
  try {
    const data = await postJSON('/batch-close', payload);
    renderResult('Batch Close', data);
  } catch (e) { log('ERROR: ' + e.message); }
});


$('btnVoid').addEventListener('click', async () => {
  reset();
  const { ip, port, ecrId } = baseConn();
  const tranNo  = $('voidTranNo').value.trim();
  const ref     = $('voidRef').value.trim();
  const invoice = $('voidInvoice').value.trim();
  const clerkId = $('voidClerk').value.trim();

  const payload = {
    ip, port, ecrId,
    void: {
      params: {},
      transaction: {}
    }
  };
  if (tranNo)  payload.void.transaction.tranNo = tranNo;
  if (ref)     payload.void.transaction.referenceNumber = ref;
  if (invoice) payload.void.transaction.invoiceNbr = invoice;
  if (clerkId) payload.void.params.clerkId = clerkId;

  try {
    const data = await postJSON('/void', payload);
    renderResult('Void', data);
  } catch (e) { log('ERROR: ' + e.message); }
});

  </script>
</body>
</html>




